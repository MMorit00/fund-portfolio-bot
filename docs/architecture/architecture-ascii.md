# Fund Portfolio Bot - 分层架构图（v0.3）

```
┌─────────────────────────────────────────────────────────────────┐
│                    src/jobs（驱动层）                            │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                        Jobs                              │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                   src/app（启动与装配）                          │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    CLI & Wiring                          │    │
│  └─────────────────────────────────────────────────────────┘    │
└──────────────┬──────────────────────────────┬───────────────────┘
               │                              │
               │                              │ 装配依赖
               ▼                              ▼
┌──────────────────────────────┐    ┌─────────────────────────────┐
│  src/usecases（用例编排）     │    │  src/adapters（被驱动适配器） │
│ ┌──────────────────────────┐ │    │ ┌─────────────────────────┐ │
│ │    TradingUsecases       │ │    │ │     SqliteRepos         │ │
│ ├──────────────────────────┤ │    │ ├─────────────────────────┤ │
│ │      DcaUsecases         │ │    │ │    Calendar             │ │
│ ├──────────────────────────┤ │    │ ├─────────────────────────┤ │
│ │   PortfolioUsecases      │ │    │ │     NavServices         │ │
│ ├──────────────────────────┤ │    │ ├─────────────────────────┤ │
│ │  MarketdataUsecases      │ │    │ │    ReportService        │ │
│ └──────────────────────────┘ │    │ └─────────────────────────┘ │
└──────────────┬───────────────┘    └──────────────┬──────────────┘
               │                                   │
               │                                   │ 实现 Protocol
               ▼                                   ▼
┌─────────────────────────────────────────────────────────────────┐
│                src/core（领域模型 + 接口）                        │
│  ┌──────────────────────┐    ┌──────────────────────────────┐   │
│  │      Protocols       │    │        DomainModel           │   │
│  └──────────────────────┘    └──────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘

                              外部系统
        ┌─────────────┐  ┌───────────────┐  ┌─────────────────┐
        │  SQLite DB  │  │ Eastmoney API │  │ Discord Webhook │
        └─────────────┘  └───────────────┘  └─────────────────┘
```

## 依赖方向

- **Jobs → App → Usecases → Core**：调用链向内依赖
- **Adapters → Core**：适配器实现 Core 中的 Protocol
- **App → Adapters**：wiring 装配时依赖具体适配器
- **Core 不依赖外层**：领域模型和接口是最内层

## 各层职责

| 层 | 目录 | 职责 |
|---|---|---|
| 驱动层 | `src/jobs` | 定时任务入口，调用 App 层 |
| 启动层 | `src/app` | CLI、配置、依赖装配（wiring） |
| 用例层 | `src/usecases` | 业务流程编排，依赖 Protocol |
| 核心层 | `src/core` | 领域模型、业务规则、Protocol 定义 |
| 适配器 | `src/adapters` | 实现 Protocol（DB、HTTP、通知） |
