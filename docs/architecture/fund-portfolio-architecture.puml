@startuml FundPortfolioArchitecture
skinparam backgroundColor white
skinparam defaultFontName "PingFang SC,Microsoft YaHei,SimHei,Arial Unicode MS"

title Fund Portfolio Bot - 分层与依赖（v0.3）

skinparam package {
  FontSize 12
}
skinparam component {
  FontSize 11
}

' ============================
' 配色方案
' ============================
skinparam package {
  BackgroundColor<<jobs>> #E3F2FD
  BackgroundColor<<app>> #FFF3E0
  BackgroundColor<<usecases>> #F3E5F5
  BackgroundColor<<core>> #E8F5E9
  BackgroundColor<<adapters>> #FBE9E7
}

skinparam component {
  BackgroundColor #FFFFFF
  BorderColor #666666
}

' ============================
' 纵向分层布局
' ============================

' --- 第1层：驱动层 ---
package "src/jobs（驱动层）" <<jobs>> as PKG_Jobs {
  component "Jobs" as Jobs
}

' --- 第2层：启动与装配 ---
package "src/app（启动与装配）" <<app>> as PKG_App {
  component "CLI & Wiring" as App
}

' --- 第3层：用例编排 ---
package "src/usecases（用例编排）" <<usecases>> as PKG_Usecases {
  component "TradingUsecases" as UCTrading
  component "DcaUsecases" as UCDca
  component "PortfolioUsecases" as UCPortfolio
  component "MarketdataUsecases" as UCMarketdata
}

' --- 第4层：核心（领域模型 + 接口） ---
package "src/core（领域模型 + 接口）" <<core>> as PKG_Core {
  component "Protocols" as CoreProtocols
  component "DomainModel" as CoreDomain
}

' --- 第5层：适配器 ---
package "src/adapters（被驱动适配器）" <<adapters>> as PKG_Adapters {
  component "SqliteRepos" as AdpSqlite
  component "SqliteCalendar" as AdpCalendar
  component "NavServices" as AdpNav
  component "ReportService" as AdpReport
}

' --- 外部系统 ---
database "SQLite DB" as Sqlite
cloud "Eastmoney API" as Eastmoney
cloud "Discord Webhook" as Discord

' ============================
' 依赖方向（纵向向下）
' ============================

' 第1层 → 第2层
Jobs --> App

' 第2层 → 第3层
App --> PKG_Usecases

' 第2层 → 第5层（装配时依赖具体适配器）
App ..> PKG_Adapters : 装配依赖

' 第3层 → 第4层
PKG_Usecases --> PKG_Core

' 第5层 → 第4层（适配器实现接口）
PKG_Adapters ..> PKG_Core : 实现 Protocol

' 适配器 → 外部系统
AdpSqlite --> Sqlite
AdpCalendar --> Sqlite
AdpNav --> Eastmoney
AdpReport --> Discord

' ============================
' 简要说明
' ============================

note bottom of PKG_Core
  依赖方向：Jobs → App → Usecases → Core
  Adapters 实现 Core 中的 Protocol
  Core 不依赖外层
end note

@enduml
