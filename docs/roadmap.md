# Roadmapï¼ˆç‰ˆæœ¬è§„åˆ’ï¼‰

## äº§å“å®šä½

- **å·¥å…·å®šä½**ï¼šä¸ªäººåŸºé‡‘æŠ•èµ„çš„"å½±å­è®°è´¦ + å†³ç­–è¾…åŠ©ç³»ç»Ÿ"
- **äº¤æ˜“å¹³å°**ï¼šå›½å†…å¹³å°ï¼ˆä¼˜å…ˆæ”¯ä»˜å®ï¼‰
- **åŒæ­¥æ¨¡å¼**ï¼šä¼ªåŒæ­¥â€”â€”ç”¨æˆ·åœ¨å¹³å°å®Œæˆæ“ä½œåæ‰‹åŠ¨å½•å…¥ç¡®è®¤
- **æŠ¥å‘Šå£å¾„**ï¼šåŸºäºå®˜æ–¹æ—¥åº¦å‡€å€¼ï¼Œä¸åšç›˜ä¸­äº¤æ˜“
- **AI å®šä½**ï¼šå½“å‰ä»…åšæ•°æ®å‡†å¤‡ï¼Œä¸å®ç° AI å†³ç­–

## ç‰ˆæœ¬æ€»è§ˆ

- âœ… **v0.1**ï¼šMVP åŸºç¡€åŠŸèƒ½ï¼ˆäº¤æ˜“å½•å…¥ã€å®šæŠ•ã€NAV æŠ“å–ã€ç¡®è®¤ã€æ—¥æŠ¥ï¼‰
- âœ… **v0.2**ï¼šæ”¯ä»˜å®é—­ç¯ï¼ˆä¸¥æ ¼ NAV ç­–ç•¥ã€å»¶è¿Ÿè¿½è¸ªã€å†å¹³è¡¡ï¼‰
- âœ… **v0.3**ï¼šæ—¥å†ç­–ç•¥åŒ–ï¼ˆSettlementPolicyã€Schema v3ï¼‰
- âœ… **v0.3.1**ï¼šæ¶æ„ç®€åŒ–ï¼ˆç›®å½•é‡æ„ã€ä¾èµ–æ³¨å…¥ï¼‰
- âœ… **v0.3.2**ï¼šé…ç½®ç®¡ç† CLI + ä»£ç æ¸…ç†ï¼ˆè¡¥é½ç”¨æˆ·é—­ç¯ï¼‰
- âœ… **v0.3.3**ï¼šå†å¹³è¡¡ç‹¬ç«‹ CLI + åŸºé‡‘çº§åˆ«å»ºè®®ï¼ˆå®Œå–„å†³ç­–è¾…åŠ©ï¼‰
- âœ… **v0.3.4+**ï¼šé—­ç¯å®Œå–„ï¼ˆæœˆåº¦å®šæŠ•çŸ­æœˆé¡ºå»¶ + æ‰‹åŠ¨ç¡®è®¤ + æ—¥å†ç®¡ç†ï¼‰
- âœ… **v0.4**ï¼šè¡Œä¸ºæ•°æ®åŸºå»ºï¼ˆaction_log è¡¨ + åŸ‹ç‚¹ï¼‰
- ğŸ”œ **v0.4.1+**ï¼šè¡Œä¸ºæ•°æ®å¢å¼ºï¼ˆå‘¨æŠ¥/å†å²å¯¼å…¥/æ›´å¤šåŸ‹ç‚¹ï¼‰
- ğŸ”® **v1.x+**ï¼šAI è¾…åŠ©å†³ç­–ï¼ˆè¿œæœŸï¼‰

---

## v0.3.4+ï¼ˆé—­ç¯å®Œå–„ï¼Œâœ… å·²å®Œæˆï¼‰

### ç›®æ ‡

ä¿®å¤ä¸šåŠ¡é—­ç¯æ–­ç‚¹ï¼Œè¡¥å…¨ç¼ºå¤±åŠŸèƒ½ï¼Œå®Œå–„æ–‡æ¡£è¯´æ˜ï¼Œè¾¾åˆ°ç”Ÿäº§å¯ç”¨çŠ¶æ€ã€‚

### å®Œæˆå†…å®¹

**P1 æ–­ç‚¹ä¿®å¤**ï¼š
- âœ… æœˆåº¦å®šæŠ•çŸ­æœˆé¡ºå»¶ï¼šrule=31 åœ¨ 2 æœˆ/4 æœˆç­‰çŸ­æœˆè‡ªåŠ¨é¡ºå»¶åˆ°æœˆæœ«æœ€åä¸€å¤©
- âœ… æ‰‹åŠ¨ç¡®è®¤ CLIï¼šæ–°å¢ `trade confirm-manual` å‘½ä»¤ï¼Œåº”å¯¹ NAV æ°¸ä¹…ç¼ºå¤±åœºæ™¯

**æ—¥å†ç®¡ç†å®Œå–„**ï¼š
- âœ… æ–‡æ¡£æ›´æ–°ï¼šè¡¥å…… `calendar sync` / `patch-cn-a` å®Œæ•´ç”¨æ³•
- âœ… ä¾èµ–è¯´æ˜ï¼šexchange-calendars å’Œ akshare å·²åœ¨ pyproject.toml ä¸­å£°æ˜
- âœ… é”™è¯¯ä¼˜åŒ–ï¼šæä¾›é™çº§è·¯å¾„æç¤ºï¼ˆCSV å¯¼å…¥ç­‰ï¼‰

**æ–‡æ¡£æ¸…ç†**ï¼š
- âœ… æ›´æ–°è·¯å¾„å¼•ç”¨ï¼šç»Ÿä¸€ä½¿ç”¨ v0.3.1 åçš„è·¯å¾„ï¼ˆdata/db/ï¼‰
- âœ… åˆ é™¤è¿‡æ—¶å†…å®¹ï¼šç§»é™¤å·²åºŸå¼ƒçš„è„šæœ¬å’Œè¯´æ˜
- âœ… Schema v4 æ›´æ–°ï¼šè¡¥å…… v0.3.4+ å˜æ›´å†å²

### éªŒè¯ç»“æœ

- âœ… **ä¸šåŠ¡é—­ç¯ 100% å®Œæ•´**ï¼šé…ç½®/æ—¥å¸¸/å¼‚å¸¸/æ—¥å†/è¾¹ç•Œåœºæ™¯å…¨éƒ¨è¦†ç›–
- âœ… **ä»£ç è´¨é‡éªŒè¯**ï¼šruff check å…¨éƒ¨é€šè¿‡
- âœ… **æ–‡æ¡£å®Œæ•´æ€§**ï¼šoperations-log / settlement-rules / sql-schema / coding-log å…¨éƒ¨æ›´æ–°

---

## v0.3.3ï¼ˆå†å¹³è¡¡ç‹¬ç«‹ CLI + åŸºé‡‘çº§åˆ«å»ºè®®ï¼Œâœ… å·²å®Œæˆï¼‰

### ç›®æ ‡

è¡¥é½å†å¹³è¡¡åŠŸèƒ½é—­ç¯ï¼Œæä¾›ç‹¬ç«‹ CLI å’Œå…·ä½“åŸºé‡‘çº§åˆ«å»ºè®®ï¼Œå®Œå–„å†³ç­–è¾…åŠ©ä½“éªŒã€‚

### èƒŒæ™¯é—®é¢˜

**å½“å‰ç¼ºé™·**ï¼š
- âŒ ç¼ºå°‘ç‹¬ç«‹å†å¹³è¡¡ CLIï¼šç”¨æˆ·å¿…é¡»è·‘å®Œæ•´æ—¥æŠ¥æ‰èƒ½æŸ¥çœ‹å†å¹³è¡¡å»ºè®®
- âŒ åªç»™èµ„äº§ç±»åˆ«å»ºè®®ï¼šç”¨æˆ·çœ‹åˆ°"å›½å†…æƒç›Šä¹° 5000"ï¼Œä¸çŸ¥é“ä¹°å“ªåªåŸºé‡‘

**ç”¨æˆ·ç—›ç‚¹**ï¼š
```bash
# å½“å‰æµç¨‹ï¼šå¿…é¡»è·‘å®Œæ•´æ—¥æŠ¥
python -m src.cli.report   # è¾“å‡ºä¸€å¤§å †æ—¥æŠ¥å†…å®¹ï¼Œå†å¹³è¡¡å»ºè®®åœ¨æœ€å

# é—®é¢˜ 1ï¼šä¸å¤Ÿçµæ´»ï¼Œæ— æ³•å•ç‹¬æŸ¥çœ‹å†å¹³è¡¡å»ºè®®
# é—®é¢˜ 2ï¼šå»ºè®®ä¸å¤Ÿå…·ä½“ï¼Œåªåˆ°èµ„äº§ç±»åˆ«çº§åˆ«
```

### å®Œæˆå†…å®¹

**é˜¶æ®µ 1ï¼šç‹¬ç«‹ CLI å…¥å£**ï¼ˆâœ… å·²å®Œæˆï¼‰
- âœ… æ–°å¢ `src/cli/rebalance.py`ï¼ˆ107 è¡Œï¼‰
- âœ… æ”¯æŒ `--as-of` å‚æ•°æŒ‡å®šå±•ç¤ºæ—¥æœŸ
- âœ… é»˜è®¤å±•ç¤ºä¸Šä¸€äº¤æ˜“æ—¥ï¼ˆä¸æ—¥æŠ¥ä¸€è‡´ï¼‰
- âœ… æ¸…æ™°çš„èµ„äº§ç±»åˆ«çº§åˆ«è¾“å‡ºï¼ˆæ€»å¸‚å€¼ã€é…ç½®çŠ¶æ€ã€è°ƒä»“å»ºè®®ï¼‰

**é˜¶æ®µ 2ï¼šåŸºé‡‘çº§åˆ«å»ºè®®**ï¼ˆâœ… å·²å®Œæˆï¼‰
- âœ… æ–°å¢ `FundSuggestion` æ•°æ®ç±»ï¼ˆåŒ…å«åŸºé‡‘ä»£ç ã€åç§°ã€å»ºè®®é‡‘é¢ã€å½“å‰å æ¯”ï¼‰
- âœ… å¢å¼º `RebalanceResult`ï¼šæ·»åŠ  `fund_suggestions` å­—æ®µ
- âœ… æ–°å¢ `_suggest_specific_funds()` å‡½æ•°ï¼šæ™ºèƒ½åˆ†é…é‡‘é¢åˆ°å…·ä½“åŸºé‡‘
  - ä¹°å…¥ç­–ç•¥ï¼šä¼˜å…ˆæ¨èæŒä»“è¾ƒå°çš„åŸºé‡‘ï¼ˆå¹³å‡åŒ–ï¼‰
  - å–å‡ºç­–ç•¥ï¼šä¼˜å…ˆæ¨èæŒä»“è¾ƒå¤§çš„åŸºé‡‘ï¼ˆæ¸è¿›å¼å‡ä»“ï¼‰
- âœ… CLI è¾“å‡ºæ˜¾ç¤ºå…·ä½“åŸºé‡‘å»ºè®®ï¼ˆä»£ç  + åç§° + é‡‘é¢ + å æ¯”ï¼‰

### ç”¨æˆ·ä½“éªŒæ”¹è¿›

**æ”¹è¿›å‰**ï¼š
```bash
# å¿…é¡»è·‘å®Œæ•´æ—¥æŠ¥ï¼Œè¾“å‡ºå†—é•¿
python -m src.cli.report

# è¾“å‡ºï¼š
# ã€æŒä»“æ—¥æŠ¥ 2025-11-21 | æ¨¡å¼ï¼šå¸‚å€¼ã€‘
# æ€»å¸‚å€¼ï¼š2964.17
# èµ„äº§é…ç½®ï¼š...
# âš ï¸ å†å¹³è¡¡æç¤ºï¼š
# - US_QDII ä½é…ï¼Œå»ºè®®å¢æŒ   # âŒ ä¸å¤Ÿå…·ä½“ï¼Œä¸çŸ¥é“ä¹°å“ªåª
```

**æ”¹è¿›å**ï¼š
```bash
# ç‹¬ç«‹è¿è¡Œï¼Œå¿«é€ŸæŸ¥çœ‹
python -m src.cli.rebalance

# è¾“å‡ºï¼š
# ğŸ“Š å†å¹³è¡¡å»ºè®®ï¼ˆ2025-11-21ï¼‰
#
# æ€»å¸‚å€¼ï¼šÂ¥2,964.17
#
# å½“å‰èµ„äº§é…ç½®ï¼š
#   CSI300: 100.0% (ç›®æ ‡ 50.0%) âš ï¸ åé«˜ 50.0%
#   US_QDII: 0.0% (ç›®æ ‡ 30.0%) âš ï¸ åä½ 30.0%
#
# è°ƒä»“å»ºè®®ï¼š
#   CSI300ï¼šå»ºè®®å–å‡º Â¥741
#     â€¢ [110022] æ˜“æ–¹è¾¾æ²ªæ·±300ETFè”æ¥ï¼šÂ¥741 (å½“å‰å æ¯” 100.0%)  # âœ… å…·ä½“åˆ°åŸºé‡‘
#   US_QDIIï¼šå»ºè®®ä¹°å…¥ Â¥445  # âœ… æ˜ç¡®é‡‘é¢
```

### æŠ€æœ¯äº®ç‚¹

1. **æ™ºèƒ½åŸºé‡‘åˆ†é…ç­–ç•¥**ï¼š
   - ä¹°å…¥ï¼šå¹³å‡åŒ–æŒä»“ï¼ˆä¼˜å…ˆæ¨èæŒä»“è¾ƒå°çš„åŸºé‡‘ï¼‰
   - å–å‡ºï¼šæ¸è¿›å¼å‡ä»“ï¼ˆä¼˜å…ˆæ¨èæŒä»“è¾ƒå¤§çš„åŸºé‡‘ï¼‰
   - è‡ªåŠ¨æŒ‰é‡‘é¢é™åºæ’åº

2. **æ™ºèƒ½é™çº§å¤„ç†**ï¼š
   - æœ‰æŒä»“çš„èµ„äº§ç±»åˆ«ï¼šæ˜¾ç¤ºå…·ä½“åŸºé‡‘å»ºè®®
   - æ— æŒä»“çš„èµ„äº§ç±»åˆ«ï¼šåªæ˜¾ç¤ºèµ„äº§ç±»åˆ«çº§åˆ«å»ºè®®

3. **å¤ç”¨ç°æœ‰æ¶æ„**ï¼š
   - å®Œå…¨åŸºäº v0.3.1 ä¾èµ–æ³¨å…¥æœºåˆ¶
   - æ— æ–°å¢å¤–éƒ¨ä¾èµ–
   - ç¬¦åˆåˆ†å±‚æ¶æ„è§„èŒƒ

### éªŒè¯æ ‡å‡†

- âœ… ç”¨æˆ·å¯å•ç‹¬è¿è¡Œå†å¹³è¡¡ CLI
- âœ… è¾“å‡ºåŒ…å«å…·ä½“åŸºé‡‘ä»£ç ã€åç§°ã€å»ºè®®é‡‘é¢
- âœ… ä¹°å…¥/å–å‡ºç­–ç•¥ç¬¦åˆé¢„æœŸï¼ˆå¹³å‡åŒ– vs æ¸è¿›å¼ï¼‰
- âœ… `ruff check --fix .` å…¨éƒ¨é€šè¿‡
- âœ… ä»£ç ç¬¦åˆé¡¹ç›®ç¼–ç è§„èŒƒ

---

## v0.3.2ï¼ˆé…ç½®ç®¡ç† CLI + ä»£ç æ¸…ç†ï¼Œâœ… å·²å®Œæˆï¼‰

### ç›®æ ‡

è¡¥é½é…ç½®ç®¡ç†å…¥å£ï¼Œè®©ç”¨æˆ·æ— éœ€ç›´æ¥æ“ä½œæ•°æ®åº“å³å¯å®Œæˆåˆå§‹åŒ–ï¼Œå½¢æˆå®Œæ•´çš„æŠ•èµ„ç®¡ç†é—­ç¯ã€‚åŒæ—¶æ¸…ç†å‘åå…¼å®¹ä»£ç ï¼Œä¼˜åŒ–ä¾èµ–æ³¨å…¥æœºåˆ¶ã€‚

### èƒŒæ™¯é—®é¢˜

**å½“å‰ç¼ºé™·**ï¼š
- âœ… æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆFlow å±‚ï¼‰ï¼šå®Œæ•´
- âœ… æ•°æ®æ¨¡å‹ï¼ˆSchema v3ï¼‰ï¼šå®Œæ•´
- âŒ CLI ç”¨æˆ·å…¥å£ï¼šä¸å®Œæ•´ï¼ˆç¼ºå°‘é…ç½®ç®¡ç†ï¼‰

**ç”¨æˆ·ç—›ç‚¹**ï¼š
```sql
-- ç”¨æˆ·å¿…é¡»æ‰‹åŠ¨å†™ SQL æ‰èƒ½å¼€å§‹ä½¿ç”¨ç³»ç»Ÿ
INSERT INTO funds VALUES (...);
INSERT INTO dca_plans VALUES (...);
INSERT INTO alloc_config VALUES (...);

-- ç„¶åæ‰èƒ½ç”¨ CLI
python -m src.cli.dca
python -m src.cli.confirm
```

### å®Œæˆå†…å®¹

**é˜¶æ®µ 1ï¼šé…ç½®ç®¡ç† CLI**

- âœ… **Schema v4**ï¼š`dca_plans.status`ã€å¸‚åœºç±»å‹æ ‡å‡†åŒ–ï¼ˆ`CN_A`/`US_NYSE`ï¼‰
- âœ… **Flow å‡½æ•°**ï¼ˆ`flows/config.py`ï¼‰ï¼š`add_fund`ã€`list_funds`ã€`add_dca_plan`ã€`list_dca_plans`ã€`enable/disable_dca_plan`ã€`set_allocation`ã€`list_allocations`
- âœ… **Flow å‡½æ•°**ï¼ˆ`flows/trade.py`ï¼‰ï¼š`list_trades`ï¼ˆæ”¯æŒçŠ¶æ€ç­›é€‰ï¼‰
- âœ… **CLI å‘½ä»¤**ï¼š`fund.py`ã€`dca_plan.py`ã€`alloc.py`ã€`trade.py`ï¼ˆbuy/sell/listï¼‰
- âœ… **ä»“å‚¨å±‚**ï¼š`DcaPlanRepo`ã€`AllocConfigRepo`ã€`TradeRepo`ã€`FundRepo` åŠŸèƒ½å¢å¼º

**é˜¶æ®µ 2ï¼šä»£ç æ¸…ç†ä¸ä¼˜åŒ–**

- âœ… **åˆ é™¤å…¼å®¹ä»£ç **ï¼š`DcaPlanRepo`ã€`DbHelper`ã€`TradeRepo`ã€`settlement.py` ä¸­çš„å‘åå…¼å®¹é€»è¾‘
- âœ… **ä¾èµ–æ³¨å…¥ä¼˜åŒ–**ï¼š`flows/__init__.py` å•ç‚¹è§¦å‘ï¼Œåˆ é™¤ 5 ä¸ª flow æ¨¡å—çš„é‡å¤å¯¼å…¥
- âœ… **è„šæœ¬æ›´æ–°**ï¼š`scripts/dev_seed_db.py` å‡çº§ä¸º v0.3.2 æ¶æ„
- âœ… **æ–‡æ¡£æ›´æ–°**ï¼š`operations-log.md` æ¾„æ¸… Schema ç®¡ç†ç°çŠ¶
- âœ… **å…¨é¢éªŒè¯**ï¼šæ‰€æœ‰ CLI å‘½ä»¤æµ‹è¯•é€šè¿‡ã€ä¾èµ–æ³¨å…¥æ­£å¸¸ã€Ruff æ£€æŸ¥é€šè¿‡

### ç”¨æˆ·ä½“éªŒæ”¹è¿›

**æ”¹è¿›å‰**ï¼š
```bash
# å¿…é¡»æ‰‹åŠ¨å†™ SQL
sqlite3 data/portfolio.db "INSERT INTO funds ..."
```

**æ”¹è¿›å**ï¼š
```bash
# 1. é…ç½®åŸºé‡‘
python -m src.cli.fund add --code 000001 --name "åå¤æˆé•¿" --class EQUITY_CN --market CN_A

# 2. è®¾ç½®å®šæŠ•è®¡åˆ’
python -m src.cli.dca_plan add --fund 000001 --freq monthly --day 1 --amount 1000

# 3. è®¾ç½®èµ„äº§é…ç½®ç›®æ ‡
python -m src.cli.alloc set --class EQUITY_CN --target 0.60 --max-dev 0.05

# 4. æ‰‹åŠ¨äº¤æ˜“
python -m src.cli.trade buy --fund 000001 --amount 5000

# 5. å¼€å§‹æ—¥å¸¸è¿ç»´ï¼ˆå·²æœ‰ï¼‰
python -m src.cli.dca
python -m src.cli.fetch_navs
python -m src.cli.confirm
python -m src.cli.report
```

### å®Œæ•´ä¸šåŠ¡é—­ç¯

```
é…ç½®ç®¡ç†é˜¶æ®µï¼ˆæ–°å¢ï¼‰:
  fund add â†’ dca_plan add â†’ alloc set
    â†“
æ—¥å¸¸è¿ç»´é˜¶æ®µï¼ˆå·²æœ‰ï¼‰:
  dca â†’ trade buy/sell â†’ fetch_navs â†’ confirm â†’ report
    â†“
å†³ç­–è°ƒæ•´é˜¶æ®µï¼ˆå·²æœ‰ï¼‰:
  reportï¼ˆå†å¹³è¡¡å»ºè®®ï¼‰ â†’ trade buy/sell â†’ å›åˆ°æ—¥å¸¸è¿ç»´
```

### éªŒè¯æ ‡å‡†

- âœ… å…¨æ–°ç”¨æˆ·æ— éœ€æ¥è§¦æ•°æ®åº“å³å¯å®Œæˆåˆå§‹åŒ–
- âœ… æ‰€æœ‰é…ç½®æ”¯æŒ CLI å¢åˆ æ”¹æŸ¥
- âœ… ä¿æŒæ¶æ„åˆ†å±‚æ¸…æ™°ï¼ˆCLI â†’ Flow â†’ Dataï¼‰
- âœ… æ‰€æœ‰ CLI å‘½ä»¤ç¬¦åˆé¡¹ç›®ç¼–ç è§„èŒƒ
- âœ… `ruff check --fix .` å…¨éƒ¨é€šè¿‡

---

## v0.3.1ï¼ˆæ¶æ„ç®€åŒ–ï¼Œâœ… å·²å®Œæˆï¼‰

### ç›®æ ‡

åœ¨ä¸æ–°å¢åŠŸèƒ½çš„å‰æä¸‹ç®€åŒ–ä»£ç ç»“æ„ï¼Œä¸ºæœªæ¥æ‰©å±•é“ºå¹³é“è·¯ã€‚

### å®Œæˆå†…å®¹

**âœ… ç›®å½•ç»“æ„é‡ç»„**ï¼š
- `jobs/` â†’ `cli/`ï¼šå‘½ä»¤è¡Œå…¥å£
- `usecases/` â†’ `flows/`ï¼šä¸šåŠ¡æµç¨‹ï¼ˆ8 ä¸ªç±»åˆå¹¶åˆ° 4 ä¸ªæ–‡ä»¶ï¼‰
- `adapters/` â†’ `data/`ï¼šæ•°æ®å±‚ï¼ˆdb/ + client/ï¼‰
- `app/` â†’ `core/`ï¼šé…ç½®å’Œæ—¥å¿—ç§»å…¥æ ¸å¿ƒå±‚
- `core/` é‡ç»„ä¸º `models/` + `rules/`

**âœ… åˆ é™¤æŠ½è±¡å±‚**ï¼š
- åˆ é™¤ `src/core/protocols.py`ï¼ˆProtocol å®šä¹‰ï¼‰
- åˆ é™¤ `src/app/wiring.py`ï¼ˆDependencyContainerï¼‰
- æ‰€æœ‰ Repo ç±»å»é™¤ Protocol ç»§æ‰¿

**âœ… ç±»åç®€åŒ–**ï¼š
- `SqliteTradeRepo` â†’ `TradeRepo`
- `SqliteFundRepo` â†’ `FundRepo`
- `SqliteNavRepo` â†’ `NavRepo`
- `SqliteDcaPlanRepo` â†’ `DcaPlanRepo`
- `SqliteAllocConfigRepo` â†’ `AllocConfigRepo`
- `DbCalendarService` â†’ `CalendarService`
- `SqliteDbHelper` â†’ `DbHelper`

**âœ… ä¾èµ–æ³¨å…¥é‡æ„**ï¼ˆé˜¶æ®µ 2ï¼‰ï¼š
- Flow å±‚ï¼šä¸šåŠ¡ç±»æ”¹ä¸ºçº¯å‡½æ•°ï¼ˆ8 ä¸ªå‡½æ•°ï¼‰
- è£…é¥°å™¨ï¼š`@dependency` è‡ªåŠ¨æ³¨å…¥ä¾èµ–
- å®¹å™¨ï¼š`src/core/container.py` é›†ä¸­ç®¡ç† 9 ä¸ªä¾èµ–å·¥å‚
- CLI å±‚ï¼šä¸€è¡Œè°ƒç”¨ Flow å‡½æ•°ï¼Œæ— éœ€æ‰‹åŠ¨å®ä¾‹åŒ–

**âœ… éªŒè¯é€šè¿‡**ï¼š
- Ruff æ£€æŸ¥ï¼šå…¨éƒ¨é€šè¿‡
- åŠŸèƒ½æµ‹è¯•ï¼šCLI å‘½ä»¤æ­£å¸¸è¿è¡Œ
- Schema ç‰ˆæœ¬ï¼šä¿æŒ v3 ä¸å˜
- ä»£ç å‡å°‘ï¼š~200 è¡Œæ ·æ¿ä»£ç 

### æ¶æ„å¯¹æ¯”

**Beforeï¼ˆ4 å±‚ï¼‰**ï¼š
```
Jobs â†’ DependencyContainer â†’ UseCase (Protocol) â†’ Repo (implements Protocol)
```

**Afterï¼ˆ3 å±‚ + ä¾èµ–æ³¨å…¥ï¼‰**ï¼š
```
CLI â†’ Flows (çº¯å‡½æ•° + @dependency) â†’ Data (é€šè¿‡è£…é¥°å™¨æ³¨å…¥)
         â†“
      Core (container + dependency)
```

---

## v0.1-v0.3ï¼ˆå·²å®ŒæˆåŠŸèƒ½ï¼‰

### æ ¸å¿ƒåŠŸèƒ½

- âœ… äº¤æ˜“å½•å…¥ï¼š`CreateTrade`
- âœ… å®šæŠ•æ‰§è¡Œï¼š`RunDailyDca` / `SkipDca`
- âœ… NAV æŠ“å–ï¼š`FetchNavs`ï¼ˆå•æ—¥ + åŒºé—´ï¼‰
- âœ… äº¤æ˜“ç¡®è®¤ï¼š`ConfirmTrades`ï¼ˆT+N è§„åˆ™ï¼Œå»¶è¿Ÿè¿½è¸ªï¼‰
- âœ… æ—¥æŠ¥æ¨é€ï¼š`MakeDailyReport`ï¼ˆDiscordï¼‰
- âœ… å†å¹³è¡¡å»ºè®®ï¼š`MakeRebalance`
- âœ… çŠ¶æ€æ‘˜è¦ï¼š`MakeStatusSummary`ï¼ˆå¸‚å€¼/ä»½é¢è§†å›¾ï¼‰

### å…³é”®ç‰¹æ€§

- âœ… **äº¤æ˜“æ—¥å†**ï¼š`CalendarService` + `trading_calendar` è¡¨
- âœ… **ç»“ç®—ç­–ç•¥**ï¼š`SettlementPolicy`ï¼ˆå«å…µ/å®šä»·/è®¡æ•°æ—¥å†ï¼‰
- âœ… **å®šä»·æ—¥æŒä¹…åŒ–**ï¼š`trades.pricing_date`ï¼ˆSchema v3ï¼‰
- âœ… **ç¡®è®¤å»¶è¿Ÿè¿½è¸ª**ï¼šæ˜¾å¼æ ‡è®°è¶…æœŸäº¤æ˜“ï¼Œæ—¥æŠ¥å±•ç¤º
- âœ… **ä¸¥æ ¼ NAV å£å¾„**ï¼šç¡®è®¤ç”¨å®šä»·æ—¥ NAVï¼Œæ—¥æŠ¥ä»…ç”¨å½“æ—¥ NAV
- âœ… **å±•ç¤ºæ—¥ç­–ç•¥**ï¼šé»˜è®¤ä¸Šä¸€äº¤æ˜“æ—¥ï¼Œæ”¯æŒ `--as-of` è¦†ç›–

> è¯¦ç»†è§„åˆ™è§ `docs/settlement-rules.md`
> CLI ç”¨æ³•è§ `docs/operations-log.md`

---

## v0.4ï¼ˆè¡Œä¸ºæ•°æ®åŸºå»ºï¼Œâœ… å·²å®Œæˆï¼‰

### ç›®æ ‡

**å®šä½**ï¼š"è®°å¾—è¶³å¤Ÿå¤šã€è®°å¾—å¤Ÿè§„èŒƒ"â€”â€” åœ¨å½“å‰æ•°æ®åŸºç¡€ä¸Šè¡¥å…¨è¡Œä¸ºæ•°æ®ç»“æ„ï¼Œä¸ºæœªæ¥æ‰€æœ‰åˆ†æåŠŸèƒ½ï¼ˆåŒ…æ‹¬ä½†ä¸é™äº AIï¼‰æ‰“å¥½åŸºç¡€ã€‚

### æ ¸å¿ƒç†å¿µ

è¡Œä¸ºæ•°æ®åŸºå»ºä¸èƒ½æ‹–åˆ° v1.x çš„ç†ç”±ï¼š
- âœ… æœªæ¥æ‰€æœ‰ AI ç›¸å…³åŠŸèƒ½éƒ½è¦ä¾èµ–è¿™å¥—æ•°æ®ç»“æ„
- âœ… è¡Œä¸ºå’Œä¸Šä¸‹æ–‡çš„åŸ‹ç‚¹ï¼Œç°åœ¨ä¸åšå°†æ¥è¡¥æ•°æ®å¾ˆç—›è‹¦
- âœ… å³ä½¿çŸ­æœŸä¸æ¥ AIï¼Œä¹Ÿèƒ½æ”¯æŒé AI çš„è¡Œä¸ºå¤ç›˜åŠŸèƒ½

### å®Œæˆå†…å®¹

**Schema å˜æ›´**ï¼š
- âœ… `SCHEMA_VERSION`ï¼š4 â†’ 5
- âœ… æ–°å¢ `action_log` è¡¨ï¼ˆ7 å­—æ®µï¼šid/action/actor/acted_at/trade_id/intent/noteï¼‰

**åŸ‹ç‚¹å®ç°**ï¼š
- âœ… æ‰‹åŠ¨ä¹°å…¥/å–å‡ºï¼ˆ`create_trade`ï¼‰â†’ action=buy/sell, actor=human
- âœ… è·³è¿‡å®šæŠ•ï¼ˆ`skip_dca`ï¼‰â†’ action=dca_skip, actor=human
- âœ… DCA è‡ªåŠ¨æ‰§è¡Œé€šè¿‡ `_log_action=False` ç¦ç”¨åŸ‹ç‚¹

**CLI å¢å¼º**ï¼š
- âœ… `trade buy/sell` æ–°å¢ `--intent` / `--note` å‚æ•°
- âœ… `dca` CLI æ”¹ä¸ºå­å‘½ä»¤æ¨¡å¼ï¼ˆ`run` / `skip`ï¼‰
- âœ… `dca skip` æ–°å¢ `--note` å‚æ•°

### è®¾è®¡å†³ç­–

**åªå»ºä¸€å¼ è¡¨**ï¼š
- åªåš `action_log`ï¼Œä¸åš `ContextSnapshot` / `Outcome`
- ç†ç”±ï¼šå¿«ç…§å’Œç»“æœå¯ä» `trades` / `navs` åŠ¨æ€è®¡ç®—ï¼Œæ— éœ€é¢„å­˜
- çœŸæ­£éœ€è¦å›ºåŒ–æ—¶å†åŠ è¡¨ï¼ˆéªŒè¯é©±åŠ¨ï¼‰

**åªè®°å½•ç”¨æˆ·å†³ç­–**ï¼š
- âœ… æ‰‹åŠ¨ä¹°å…¥/å–å‡ºã€è·³è¿‡å®šæŠ•
- âŒ ç³»ç»Ÿè‡ªåŠ¨ç¡®è®¤ã€DCA è‡ªåŠ¨æ‰§è¡Œï¼ˆtrades è¡¨å·²æœ‰çŠ¶æ€ï¼‰

**å­—æ®µç²¾ç®€**ï¼š
- å»æ‰ `source`ï¼ˆaction + actor è¶³å¤Ÿï¼‰
- å»æ‰ `plan_id`ï¼ˆå¯é€šè¿‡ trade_id è¿½æº¯ï¼‰
- å»æ‰ `extra` JSONï¼ˆæœ‰ note å°±å¤Ÿï¼‰

### éªŒè¯æ ‡å‡†

- âœ… æ‰‹åŠ¨äº¤æ˜“è‡ªåŠ¨è®°å½•åˆ° action_log
- âœ… è·³è¿‡å®šæŠ•è‡ªåŠ¨è®°å½•åˆ° action_log
- âœ… DCA è‡ªåŠ¨æ‰§è¡Œä¸è®°å½•ï¼ˆç¬¦åˆè®¾è®¡ï¼‰
- âœ… ruff check å…¨éƒ¨é€šè¿‡

---

## v0.4.1+ï¼ˆè¡Œä¸ºæ•°æ®å¢å¼ºï¼Œè§„åˆ’ä¸­ï¼‰

### ç›®æ ‡

åœ¨ v0.4 åŸºç¡€ä¸Šï¼Œæ‰©å±•åŸ‹ç‚¹è¦†ç›–å’Œæ•°æ®åˆ†æèƒ½åŠ›ã€‚

### è§„åˆ’å†…å®¹

**P1 - æ›´å¤šåŸ‹ç‚¹**ï¼š
- [ ] `rebalance` åŸ‹ç‚¹ï¼ˆå†å¹³è¡¡æ‰§è¡Œï¼‰
- [ ] `cancel_trade` åŸ‹ç‚¹ï¼ˆå–æ¶ˆäº¤æ˜“ï¼Œå¯é€‰ï¼‰

**P2 - æ•°æ®åˆ†æ**ï¼š
- [ ] **å‘¨æŠ¥ / æœˆæŠ¥**ï¼ˆè¡Œä¸ºç»Ÿè®¡è€Œéä»…æ”¶ç›Šï¼‰
  - äº¤æ˜“é¢‘ç‡ã€ç±»å‹åˆ†å¸ƒ
  - å®šæŠ•æ‰§è¡Œç‡ã€è·³è¿‡ç‡
  - intent åˆ†å¸ƒï¼ˆplanned vs impulseï¼‰
- [ ] **action_log æŸ¥è¯¢ CLI**
  - `action list --days 30`
  - `action stats`ï¼ˆç»Ÿè®¡æ‘˜è¦ï¼‰

**P3 - å†å²æ•°æ®**ï¼š
- [ ] **å†å²å¯¼å…¥**ï¼ˆCSV æ¨¡æ¿ï¼‰
  - è¡¥å…¨å†å²äº¤æ˜“æ•°æ®
  - å¯é€‰ï¼šè‡ªåŠ¨è¡¥å½• action_log

**P4 - å¿«ç…§è¡¨ï¼ˆæŒ‰éœ€ï¼‰**ï¼š
- [ ] **ContextSnapshot** è¡¨ï¼ˆä»…å½“åŠ¨æ€è®¡ç®—æˆä¸ºç“¶é¢ˆæ—¶ï¼‰
- [ ] **Outcome** è¡¨ï¼ˆä»…å½“éœ€è¦ T+N æ”¶ç›Šåˆ†ææ—¶ï¼‰

### è®¾è®¡åŸåˆ™

- **éªŒè¯é©±åŠ¨**ï¼šå…ˆç”¨è„šæœ¬åŠ¨æ€è®¡ç®—ï¼ŒçœŸæ­£æœ‰ç—›ç‚¹å†å»ºè¡¨
- **å°æ­¥è¿­ä»£**ï¼šæ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹ï¼ŒæŒ‰éœ€å¯ç”¨
- **ä¸åšé¢„æµ‹**ï¼šä¸æå‰ä¸º"å¯èƒ½éœ€è¦"çš„åŠŸèƒ½å»ºè¡¨

---

## v0.5+ï¼ˆæ•°æ®å¯é æ€§å¢å¼ºï¼Œå¾…è§„åˆ’ï¼‰

- [ ] ç›˜ä¸­ä¼°å€¼ï¼ˆé™„åŠ ä¿¡æ¯ï¼Œéæ ¸å¿ƒå£å¾„ï¼‰
- [ ] å¤šæ•°æ®æºæ”¯æŒï¼ˆå¤©å¤©åŸºé‡‘ç­‰å¤‡ä»½æºï¼‰
- [ ] NAV è‡ªåŠ¨å›å¡«ï¼ˆæ£€æµ‹ç¼ºå¤±å¹¶è¡¥æŠ“ï¼‰
- [ ] å†·å´æœŸæœºåˆ¶ï¼ˆé˜²æ­¢é¢‘ç¹äº¤æ˜“ï¼‰
- [ ] åˆ†çº¢å†æŠ•è¿½è¸ª
- [ ] è´¹ç‡è®¡ç®—ä¸å±•ç¤º

---

## v1.0ï¼ˆAI è¡Œä¸ºå¤ç›˜ï¼Œè¿œæœŸï¼‰

### ç›®æ ‡

**å®šä½**ï¼šä¸åšäº¤æ˜“å»ºè®®ï¼Œèšç„¦"è¡Œä¸ºå¤ç›˜ + è‡ªæˆ‘çº¦æŸå»ºè®®"

### æ ¸å¿ƒåœºæ™¯

åœ¨å®Œæˆ v0.4ï¼ˆUserActionLog + ContextSnapshot + Outcomeï¼‰åŸºç¡€ä¸Šï¼Œæä¾›æœ€å°æœ‰ç”¨çš„ AI åŠŸèƒ½ï¼š

**åœºæ™¯ 1ï¼šè¡Œä¸ºæ¨¡å¼åˆ†æ**
```
ç”¨æˆ·é—®ï¼š"æˆ‘è¿‡å»ä¸€å¹´éƒ½åœ¨å“ªäº›æ—¶å€™å®¹æ˜“å†²åŠ¨ä¹°å…¥ï¼Ÿ"

AI åŸºäº ActionLog + Snapshot + Outcome å›ç­”ï¼š
- ä½ æœ‰ X% çš„ä¹°å…¥å‘ç”Ÿåœ¨è¿ç»­ä¸Šæ¶¨ç¬¬ N å¤©
- å…¶ä¸­ Y% åœ¨ 30 å¤©åå›æ’¤è¶…è¿‡ Z%
- åŒæ—¶ç»™å‡ºå…·ä½“ä¾‹å­å’Œ"å¦‚æœç”¨æŸä¸ªå†·å´æœŸè§„åˆ™ä¼šæ€æ ·"
```

**åœºæ™¯ 2ï¼šè®¡åˆ’æ‰§è¡Œå¤ç›˜**
```
ç”¨æˆ·é—®ï¼š"å¸®æˆ‘çœ‹çœ‹å®šæŠ•è®¡åˆ’æ‰§è¡Œå¾—æ€ä¹ˆæ ·ï¼Ÿ"

AI å¸®ä½ ï¼š
- ç»Ÿè®¡æ¯ä¸ª DCA çš„æ‰§è¡Œç‡ã€é¢å¤–åŠ ä»“æ¬¡æ•°
- æ ‡å‡ºæœ€å®¹æ˜“"æ‰‹ç—’"çš„å‡ ä¸ªæ ‡çš„
- å¯¹æ¯”"ä¸¥æ ¼å®šæŠ•"vs"å®é™…æ“ä½œ"çš„æ”¶ç›Šå·®å¼‚
```

**åœºæ™¯ 3ï¼šè‡ªæˆ‘çº¦æŸå»ºè®®**
```
ç”¨æˆ·é—®ï¼š"æˆ‘åº”è¯¥è®¾ç½®ä»€ä¹ˆæ ·çš„å†·å´æœŸï¼Ÿ"

AI åŸºäºä½ çš„å†å²ï¼š
- åˆ†æä½ çš„äº¤æ˜“é¢‘ç‡åˆ†å¸ƒ
- æ‰¾å‡º"å†²åŠ¨äº¤æ˜“"çš„æ—¶é—´é—´éš”æ¨¡å¼
- ç»™å‡ºä¸ªæ€§åŒ–å†·å´æœŸå»ºè®®ï¼ˆè€Œéä¸€åˆ€åˆ‡ï¼‰
```

### å®Œæˆå†…å®¹

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- [ ] **è‡ªç„¶è¯­è¨€æŸ¥è¯¢æ¥å£**ï¼ˆå›´ç»•ç°æœ‰ Flows + è¡Œä¸ºæ•°æ®ï¼‰
  - æ”¯æŒæŸ¥è¯¢æŒä»“ã€äº¤æ˜“å†å²ã€é…ç½®åç¦»
  - åŸºäº ActionLog çš„æ—¶é—´åºåˆ—åˆ†æ
- [ ] **è¡Œä¸ºæ¨¡å¼åˆ†æ**
  - äº¤æ˜“æ—¶æœºåˆ†æï¼ˆå¸‚åœºçŠ¶æ€ vs äº¤æ˜“è¡Œä¸ºï¼‰
  - è®¡åˆ’æ‰§è¡Œç‡ç»Ÿè®¡ï¼ˆå®šæŠ• vs å®é™…ï¼‰
  - åç¦»åº¦ä¸æ”¶ç›Šç›¸å…³æ€§åˆ†æ
- [ ] **è‡ªæˆ‘çº¦æŸå»ºè®®**
  - ä¸ªæ€§åŒ–å†·å´æœŸå»ºè®®
  - é¢‘ç¹è°ƒä»“æé†’
  - ä¸ç›®æ ‡é…ç½®åç¦»é¢„è­¦

### è®¾è®¡åŸåˆ™

**AI å®šä½**ï¼š
- âœ… å¸®åŠ©ç”¨æˆ·ç†è§£è‡ªå·±çš„è¡Œä¸ºæ¨¡å¼
- âœ… åŸºäºç”¨æˆ·è‡ªå·±çš„å†å²æ•°æ®
- âœ… ä¸ç›´æ¥ç»™å‡ºä¹°å–å»ºè®®ï¼ˆé¿å…ç›‘ç®¡å’Œä¼¦ç†é£é™©ï¼‰
- âœ… ä¸äº§å“"è¡Œä¸º + ç­–ç•¥ + å†³ç­–è¾…åŠ©"å®šä½å¯¹é½

**æŠ€æœ¯è·¯å¾„**ï¼š
- å®Œå…¨åŸºäºå·²æœ‰æ•°æ®ç»“æ„ï¼ˆActionLog + Snapshot + Outcomeï¼‰
- ä¸éœ€è¦å¤æ‚å¤–éƒ¨å› å­
- å¯ä»¥å…ˆç”¨ç®€å•è§„åˆ™ï¼Œå†é€æ­¥å¼•å…¥æ¨¡å‹

**ä¸åšçš„äº‹**ï¼ˆå»¶ååˆ° v1.1+ï¼‰ï¼š
- âŒ AI è¾…åŠ©å®šæŠ•/å†å¹³è¡¡å»ºè®®ï¼ˆç›´æ¥ç»™æ“ä½œå»ºè®®ï¼‰
- âŒ å¤šå¸‚åœº/å¤šå¸ç§æ”¯æŒï¼ˆæ•°æ®å¤æ‚åº¦å¢åŠ ï¼‰
- âŒ é¢„æµ‹æ€§åˆ†æï¼ˆæ¶‰åŠå¤–éƒ¨æ•°æ®å’Œæ¨¡å‹é£é™©ï¼‰

### éªŒè¯æ ‡å‡†

- âœ… ç”¨æˆ·èƒ½ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢å†å²è¡Œä¸º
- âœ… èƒ½å›ç­”"æˆ‘ä»€ä¹ˆæ—¶å€™å®¹æ˜“çŠ¯é”™ï¼Ÿ"
- âœ… ç»™å‡ºçš„å»ºè®®åŸºäºç”¨æˆ·è‡ªå·±çš„å†å²æ•°æ®
- âœ… ä¸æ¶‰åŠå…·ä½“æ ‡çš„æ¨èæˆ–ä¹°å–æ—¶æœºé¢„æµ‹

---

## v1.1+ï¼ˆAI è¿›é˜¶åŠŸèƒ½ï¼Œå¾…è§„åˆ’ï¼‰

åœ¨ v1.0 åŸºç¡€ä¸Šï¼Œæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µé€æ­¥æ‰©å±•ï¼š

- [ ] AI è¾…åŠ©å†å¹³è¡¡å»ºè®®ï¼ˆåŸºäºå†å²æ‰§è¡Œæ•ˆæœï¼‰
- [ ] å¤šè´¦æˆ· / å¤šå¸‚åœºæ”¯æŒ
- [ ] å¤–éƒ¨å› å­å¼•å…¥ï¼ˆå¸‚åœºæƒ…ç»ªã€ä¼°å€¼åˆ†ä½ç­‰ï¼‰
- [ ] æ›´å¤æ‚çš„è¡Œä¸ºé¢„æµ‹æ¨¡å‹

---

## æŠ€æœ¯å€ºï¼ˆæŒç»­æ”¹è¿›ï¼‰

### äº¤æ˜“æ—¥å†

- [x] åŸºç¡€æ—¥å†è¡¨ï¼ˆv0.3 å®Œæˆï¼‰
- [x] SettlementPolicyï¼ˆv0.3 å®Œæˆï¼‰
- [ ] å®Œæ•´èŠ‚å‡æ—¥è¦†ç›–ï¼ˆæŒç»­ç»´æŠ¤ï¼‰
- [ ] åŠ¨æ€ç¡®è®¤ç­–ç•¥ï¼ˆv0.4+ï¼‰

### NAV è¦†ç›–

- [x] ä¸¥æ ¼å£å¾„ï¼ˆv0.2 å®Œæˆï¼‰
- [x] å»¶è¿Ÿè¿½è¸ªï¼ˆv0.2.1 å®Œæˆï¼‰
- [ ] å¤šæ—¥å›å¡«ä¸é‡ç®—ï¼ˆv0.4+ï¼‰
- [ ] å¤–éƒ¨æ•°æ®æº/ç¼“å­˜ï¼ˆv0.4+ï¼‰

### ä»£ç è´¨é‡

- [x] æ¶æ„ç®€åŒ–ï¼ˆv0.3.1 å®Œæˆï¼‰
- [ ] å•å…ƒæµ‹è¯•ï¼ˆv0.4+ï¼‰
- [ ] ç±»å‹æ£€æŸ¥å¢å¼ºï¼ˆv0.4+ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆæŒ‰éœ€ï¼‰

---

## å¼€å‘è·¯çº¿å›¾

```
v0.1 (MVP - åŸºç¡€åŠŸèƒ½)
  â†“
v0.2 (ä¸¥æ ¼ NAV å£å¾„ + å»¶è¿Ÿè¿½è¸ª)
  â†“
v0.3 (æ—¥å†ç­–ç•¥åŒ– + Schema v3)
  â†“
v0.3.1 (æ¶æ„ç®€åŒ– + ä¾èµ–æ³¨å…¥) âœ… å·²å®Œæˆ
  â†“
v0.3.2 (é…ç½®ç®¡ç† CLI) âœ… å·²å®Œæˆ - å½¢æˆå®Œæ•´ç”¨æˆ·é—­ç¯
  â†“
v0.3.3 (å†å¹³è¡¡ç‹¬ç«‹ CLI + åŸºé‡‘å»ºè®®) âœ… å·²å®Œæˆ - å®Œå–„å†³ç­–è¾…åŠ©
  â†“
v0.3.4+ (é—­ç¯å®Œå–„) âœ… å·²å®Œæˆ - ä¿®å¤æ–­ç‚¹ + æ–‡æ¡£å®Œå–„
  â†“
v0.4 (è¡Œä¸ºæ•°æ®åŸºå»º) âœ… å·²å®Œæˆ
  â””â”€ action_log è¡¨ + åŸ‹ç‚¹ï¼ˆbuy/sell/dca_skipï¼‰
  â†“
v0.4.1+ (è¡Œä¸ºæ•°æ®å¢å¼º) ğŸ”œ ä¸‹ä¸€æ­¥
  â”œâ”€ æ›´å¤šåŸ‹ç‚¹ï¼ˆrebalanceï¼‰
  â”œâ”€ å‘¨æŠ¥/æœˆæŠ¥ï¼ˆè¡Œä¸ºç»Ÿè®¡ï¼‰
  â””â”€ å†å²å¯¼å…¥ + action_log æŸ¥è¯¢ CLI
  â†“
v0.5+ (æ•°æ®å¯é æ€§å¢å¼º)
  â””â”€ ç›˜ä¸­ä¼°å€¼ / å¤šæ•°æ®æº / NAV å›å¡« / å†·å´æœŸ
  â†“
v1.0 (AI è¡Œä¸ºå¤ç›˜)
  â”œâ”€ è‡ªç„¶è¯­è¨€æŸ¥è¯¢
  â”œâ”€ è¡Œä¸ºæ¨¡å¼åˆ†æ
  â””â”€ è‡ªæˆ‘çº¦æŸå»ºè®®
  â†“
v1.1+ (AI è¿›é˜¶åŠŸèƒ½)
  â””â”€ è¾…åŠ©å»ºè®® / å¤šè´¦æˆ· / å¤–éƒ¨å› å­
```

**è®¾è®¡ç†å¿µæ¼”è¿›**ï¼š
- v0.1-v0.3ï¼šæ ¸å¿ƒä¸šåŠ¡èƒ½åŠ›ï¼ˆäº¤æ˜“ â†’ ç¡®è®¤ â†’ æŠ¥å‘Šï¼‰
- v0.3.1-v0.3.4+ï¼šæŠ€æœ¯æ¶æ„ä¼˜åŒ– + ç”¨æˆ·ä½“éªŒé—­ç¯ + ç”Ÿäº§å¯ç”¨
- **v0.4ï¼šæ•°æ®åŸºå»ºï¼ˆaction_log è¡¨ + åŸ‹ç‚¹ï¼‰** â¬…ï¸ å…³é”®è½¬æŠ˜ç‚¹
- v0.4.1+ï¼šæ•°æ®å¢å¼ºï¼ˆæ›´å¤šåŸ‹ç‚¹ + åˆ†æèƒ½åŠ›ï¼‰
- v0.5+ï¼šå¯é æ€§å¢å¼ºï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰
- v1.0+ï¼šAI èƒ½åŠ›ï¼ˆåŸºäºè¡Œä¸ºæ•°æ®ï¼‰

> **å½“å‰é˜¶æ®µ**ï¼šv0.4 å·²å®Œæˆï¼Œ**è¡Œä¸ºæ•°æ®åŸºå»ºå°±ç»ªï¼Œå¯è®°å½•ç”¨æˆ·å†³ç­–è¡Œä¸º**ã€‚
> **ä¸‹ä¸€æ­¥**ï¼šv0.4.1+ æŒ‰éœ€æ‰©å±•åŸ‹ç‚¹å’Œåˆ†æèƒ½åŠ›ã€‚

---
# åŠŸèƒ½è¡¨ä¸ä½¿ç”¨ 

## é…ç½®ç®¡ç†
- `æ·»åŠ åŸºé‡‘`(`add_fund`)
  - `src.cli.fund add --code 000001 --name "åå¤æˆé•¿" --class CSI300 --market CN_A`
- `æŸ¥çœ‹åŸºé‡‘`(`list_funds`)
  - `src.cli.fund list`
- `æ·»åŠ å®šæŠ•`(`add_dca_plan`)
  - `src.cli.dca_plan add --fund 000001 --amount 1000 --freq weekly --rule MON`
- `æŸ¥çœ‹å®šæŠ•`(`list_dca_plans`)
  - `src.cli.dca_plan list [--active-only]`
- `å¯ç”¨/ç¦ç”¨å®šæŠ•`(`enable_dca_plan` / `disable_dca_plan`)
  - `src.cli.dca_plan enable/disable --fund 000001`
- `è®¾ç½®é…ç½®ç›®æ ‡`(`set_allocation`)
  - `src.cli.alloc set --class CSI300 --target 0.6 --deviation 0.05`
- `æŸ¥çœ‹é…ç½®ç›®æ ‡`(`list_allocations`)
  - `src.cli.alloc show`

## äº¤æ˜“ä¸ç¡®è®¤
- `æ‰‹åŠ¨äº¤æ˜“`(`create_trade`)
  - `src.cli.trade buy/sell --fund 000001 --amount 5000 [--intent planned/impulse/opportunistic/exit] [--note "å¤‡æ³¨"]`ï¼ˆv0.4ï¼šæ”¯æŒè¡Œä¸ºæ ‡ç­¾ï¼‰
- `å–æ¶ˆäº¤æ˜“`(`cancel_trade`)
  - `src.cli.trade cancel --id <ID>`
- `æ‰‹åŠ¨ç¡®è®¤äº¤æ˜“`(`confirm_trade_manual`)
  - `src.cli.trade confirm-manual --id <ID> --shares <ä»½é¢> --nav <å‡€å€¼>`ï¼ˆv0.3.4+ï¼‰
- `æŸ¥è¯¢äº¤æ˜“`(`list_trades`)
  - `src.cli.trade list [--status pending/confirmed/skipped]`
- `ç¡®è®¤äº¤æ˜“`(`confirm_trades`)
  - `src.cli.confirm`
- `æ‰§è¡Œå®šæŠ•`(`run_daily_dca`)
  - `src.cli.dca run [--date YYYY-MM-DD]`ï¼ˆv0.4ï¼šæ”¹ä¸ºå­å‘½ä»¤ï¼‰
- `è·³è¿‡å®šæŠ•`(`skip_dca`)
  - `src.cli.dca skip --fund 000001 [--date YYYY-MM-DD] [--note "è·³è¿‡åŸå› "]`ï¼ˆv0.4 æ–°å¢ï¼‰

## æ•°æ®ä¸æŠ¥å‘Š
- `æŠ“å–å‡€å€¼`(`fetch_navs`)
  - `python -m src.cli.fetch_navs [--date 2025-01-15]`
  - `python -m src.cli.fetch_navs --funds 000001,110022`ï¼ˆv0.3.2ï¼šç²¾å‡†æŠ“å–ï¼‰
  - `python -m src.cli.fetch_navs --auto-detect-missing`ï¼ˆv0.3.2ï¼šæ™ºèƒ½è¡¥æŠ“ï¼‰
- `ç”Ÿæˆæ—¥æŠ¥`(`make_daily_report`)
  - `python -m src.cli.report [--mode market/shares] [--as-of 2025-01-15]`
- `å†å¹³è¡¡å»ºè®®`(`make_rebalance_suggestion`)
  - `python -m src.cli.rebalance [--as-of 2025-01-15]`ï¼ˆv0.3.3ï¼šç‹¬ç«‹ CLI + åŸºé‡‘å»ºè®®ï¼‰

## æ—¥å†ç®¡ç†ï¼ˆv0.3.4+ï¼‰
- `åˆ·æ–°æ—¥å†ï¼ˆCSVï¼‰`(`refresh_calendar`)
  - `python -m src.cli.calendar refresh --csv <è·¯å¾„>`
- `åŒæ­¥æ—¥å†ï¼ˆexchange_calendarsï¼‰`(`sync_calendar`)
  - `python -m src.cli.calendar sync --market CN_A --from 2020-01-01 --to 2025-12-31`
- `ä¿®è¡¥æ—¥å†ï¼ˆAkshareï¼‰`(`patch_calendar_cn_a`)
  - `python -m src.cli.calendar patch-cn-a [--back 30] [--forward 365]`

---

## å…¸å‹å·¥ä½œæµ

### é¦–æ¬¡ä½¿ç”¨
```bash
# 1. åˆå§‹åŒ–æ•°æ®åº“
SEED_RESET=1 PYTHONPATH=. python -m scripts.dev_seed_db

# 2. é…ç½®åŸºé‡‘
python -m src.cli.fund add --code 000001 --name "åå¤æˆé•¿" --class CSI300 --market CN_A

# 3. è®¾ç½®å®šæŠ•è®¡åˆ’
python -m src.cli.dca_plan add --fund 000001 --amount 1000 --freq monthly --rule 1

# 4. è®¾ç½®èµ„äº§é…ç½®
python -m src.cli.alloc set --class CSI300 --target 0.6 --deviation 0.05
```

### æ—¥å¸¸è¿ç»´
```bash
# æ¯æ—¥æ‰§è¡Œï¼ˆæŒ‰é¡ºåºï¼Œæ¨èæ—©ä¸Š 9:00 æ‰§è¡Œï¼‰
python -m src.cli.dca run          # 1. æ‰§è¡Œå®šæŠ•ï¼ˆåˆ›å»ºä»Šæ—¥äº¤æ˜“ï¼‰
python -m src.cli.fetch_navs       # 2. æŠ“å–å‡€å€¼ï¼ˆé»˜è®¤ï¼šæ˜¨æ—¥ï¼Œå› ä»Šæ—¥NAVæ™šä¸Šæ‰å…¬å¸ƒï¼‰
python -m src.cli.confirm          # 3. ç¡®è®¤äº¤æ˜“ï¼ˆç¡®è®¤æ˜¨æ—¥åˆ›å»ºçš„äº¤æ˜“ï¼‰
python -m src.cli.report           # 4. ç”Ÿæˆæ—¥æŠ¥ï¼ˆé»˜è®¤ï¼šæ˜¨æ—¥æŒä»“ï¼‰

# è·³è¿‡æŸæ—¥å®šæŠ•ï¼ˆv0.4 æ–°å¢ï¼‰
python -m src.cli.dca skip --fund 000001 --note "å¸‚åœºè¿‡çƒ­ï¼Œæš‚åœå®šæŠ•"
```

> **è¯´æ˜**ï¼š`fetch_navs` å’Œ `report` é»˜è®¤å±•ç¤º"ä¸Šä¸€å·¥ä½œæ—¥"æ•°æ®ï¼Œé€‚åˆæ—©ä¸Šå®šæ—¶æ‰§è¡Œã€‚æ™šä¸Šå¯æ‰‹åŠ¨æŒ‡å®š `--date` æŸ¥çœ‹ä»Šæ—¥å‡€å€¼ã€‚è¯¦è§ `docs/operations-log.md`ã€‚

### æ‰‹åŠ¨è°ƒä»“
```bash
# 1. æŸ¥çœ‹å†å¹³è¡¡å»ºè®®
python -m src.cli.rebalance

# 2. æ‰§è¡Œäº¤æ˜“ï¼ˆv0.4ï¼šæ”¯æŒ intent å’Œ noteï¼‰
python -m src.cli.trade buy --fund 000001 --amount 5000 --intent planned --note "å†å¹³è¡¡è¡¥ä»“"

# 3. æŸ¥çœ‹äº¤æ˜“çŠ¶æ€
python -m src.cli.trade list --status pending
```