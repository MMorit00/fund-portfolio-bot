# 版本规划

## 项目定位

个人基金投资的"影子记账 + 决策辅助系统"。基于官方日度净值，支持定投、再平衡、限额查询等核心功能。

## 版本总览

| 版本 | 状态 | 核心功能 |
|------|------|---------|
| v0.4.2 | ✅ | CSV 导入、NAV 抓取、份额计算、ActionLog |
| v0.4.3 | ✅ | DCA 回填机制、定投推断、事实快照 |
| v0.4.4 | ✅ | 限额 Facts 系统（AKShare） |
| v0.4.5 | ✅ | 账单导入重构（PDF CSV、先分析后导入） |
| v0.5.0 | 🔜 | AI 基础架构（单 AI + Tools） |
| v0.6.0 | 🔮 | AI 行为分析、周报/月报 |
| v1.x+ | 🔮 | 前端界面、多 Agent 协作（可选） |

---

## v0.5.0 AI 基础架构（规划中）

### 核心目标

搭建 AI 分析能力的基础骨架，验证"单 AI + Tools"模式。

### 架构原则

```
┌─────────────────────────────────────────────────────────────────┐
│  数据层（不改 Schema）                                           │
│  ActionLog + trades（JOIN 拼装）→ 内存中组装 AI 需要的数据        │
├─────────────────────────────────────────────────────────────────┤
│  AI 层（单 AI + Tools）                                          │
│  模型：豆包/其他国产模型（API 调用）                               │
│  边界：给建议，不执行                                             │
├─────────────────────────────────────────────────────────────────┤
│  交互层                                                          │
│  Phase 1: CLI（自然语言输入）                                     │
│  Phase 2: 前端（后续版本）                                        │
└─────────────────────────────────────────────────────────────────┘
```

### 设计要点

**数据入口**：ActionLog 是 AI 的唯一信息源
- AI 不直接访问 trades/navs，通过 Tools 获取拼装后的数据
- 不为 AI 修改数据库结构，代码层拼装

**AI 边界**：
- ✅ 分析行为模式
- ✅ 解释异常原因
- ✅ 给出建议（如"建议补充定投"）
- ❌ 不执行任何写操作

**Tools 设计**（AI 不擅长计算，我们帮它算）：
- 查询类：按时间/基金/策略查询 ActionLog
- 详情类：获取单条 ActionLog 及关联交易详情（含金额）
- 计算类：执行率统计、行为聚合、异常检测
- 上下文类：限额事实、历史对比

### 实现范围

- [ ] AI 客户端封装（豆包 API）
- [ ] Tools 函数定义（查询、计算、上下文）
- [ ] CLI 入口（自然语言 → AI → 响应）
- [ ] Prompt 模板（系统提示词）

### 不做的事情

- ❌ 多 Agent 编排（v1.x 再考虑）
- ❌ 前端界面（后续版本）
- ❌ 修改数据库 Schema

---

## v0.6.0 AI 行为分析（待规划）

基于 v0.5 的 AI 基础架构，实现具体分析场景：

- 定投执行分析（执行率、偏离原因）
- 交易行为画像（冲动型/计划型/机会型）
- 周报/月报生成
- 异常归因（限额导致 vs 主动调整）

---

## 未来规划

**v1.x+**（远期）：
- 前端界面（Web/小程序）
- 多 Agent 协作（可选，视 v0.5/v0.6 验证结果）
- 自然语言查询的深度优化

**暂时搁置**：
- NAV 缺失检测与补抓
- 多数据源支持
- 分红再投追踪

---

## AI 设计原则

### 算法 vs AI 分工

```
┌──────────────────────┬──────────────────────────────────────┐
│       规则/算法       │                 AI                   │
├──────────────────────┼──────────────────────────────────────┤
│ • 日期匹配计算        │ • 判断是否归属定投                    │
│ • 金额偏差率          │ • 解释偏差原因（限额/调整）            │
│ • 限购公告查询        │ • 综合多因素做语义判断                 │
│ • 交易模式统计        │ • 向用户提问澄清                      │
├──────────────────────┼──────────────────────────────────────┤
│     可计算/可验证      │         需要理解/判断                 │
└──────────────────────┴──────────────────────────────────────┘
```

### 数据流

```
导入阶段（临时 AI）：
  CSV → 算法 → BillFacts → AI 判断定投归属 → 回填 ActionLog.strategy

分析阶段（常驻 AI）：
  用户提问 → AI → 调用 Tools 查询 ActionLog → 分析 → 给出建议
```

---

## 禁止事项

- ❌ AI 执行交易操作（只给建议）
- ❌ 为 AI 修改数据库 Schema
- ❌ 盘中估值作为核心口径
- ❌ 过早引入多 Agent 复杂架构
