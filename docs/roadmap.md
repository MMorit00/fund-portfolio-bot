# 版本规划

## 项目定位

个人基金投资的"影子记账 + 决策辅助系统"。基于官方日度净值，支持定投、再平衡、限额查询等核心功能。

## 版本总览

| 版本 | 状态 | 核心功能 |
|------|------|---------|
| v0.4.2 | ✅ | CSV 导入、NAV 抓取、份额计算、ActionLog |
| v0.4.3 | ✅ | DCA 回填机制、定投推断、事实快照 |
| v0.4.4 | ✅ | 限额 Facts 系统（AKShare） |
| v0.4.5 | 🚧 | 代码质量优化（流程可视化、架构清理） |
| v0.4.6+ | 🔜 | 周报/月报、行为分析 |
| v0.5 | 🔜 | PDF 解析、历史限额时间线 |
| v1.x+ | 🔮 | AI 行为复盘（不做交易建议） |

## 已完成（v0.1 - v0.4.4）

✅ MVP 基础（定投、交易确认、日报、再平衡）
✅ 架构简化（依赖注入、分层清晰）
✅ 配置管理（基金、定投计划、资产配置）
✅ 行为数据（ActionLog、交易历史）
✅ 历史导入（支付宝账单、批次追溯）
✅ DCA 能力（推断、回填、事实快照）
✅ 限额查询（AKShare 实时、手动录入）

## 核心功能速查

| 功能 | 命令 | 说明 |
|------|------|------|
| **定投** | `dca_plan` | 创建、查询、启用/禁用、推断、回填 |
| **交易** | `trade` | 手动买卖、确认、查询、取消 |
| **限额** | `fund_restriction` | 查询当前、手动记录、生命周期管理 |
| **净值** | `fetch_navs` | 自动抓取、批量抓取、指定日期 |
| **报告** | `report` | 日度持仓、收益率、资产配置 |
| **日历** | `calendar` | 同步交易日历、修补缺失日期 |

## 设计原则

**算法 vs AI 分工**：
- 规则层输出事实（日期匹配、金额偏差、限额标记）
- AI 层做语义判断（是否真定投、被限额原因等）
- 用户确认修改

详见 CLAUDE.md"算法 vs AI 分工"节。

## 待讨论

**加仓标记**（v0.4.5+ 待定）：
- 场景：同一天同基金多笔交易（定投 + 手动加仓）
- 方案：`action_log.strategy` 增加 `dca_extra` / `manual` 值
- 当前：`set-core` 命令可指定哪笔是 DCA 核心，其他交易暂无标记
- 决策点：是否需要区分"定投日加仓"vs"非定投日手动买入"

## 未来规划

**v0.5**（待规划）：
- 公告 PDF 解析，构建历史限额时间线
- 支持 GPT-4o 或 Claude 3.5 Sonnet 提取限额信息

**v0.6+**（待规划）：
- NAV 缺失检测与补抓
- 多数据源支持
- 分红再投追踪

**v1.x+**（远期）：
- 自然语言查询接口
- 行为模式分析（交易时机、执行率统计）
- 自我约束建议（个性化冷却期、频繁调仓提醒）

## 禁止事项

- ❌ 实现 AI 交易建议（仅做数据准备）
- ❌ 盘中估值作为核心口径
- ❌ 复杂前端界面
